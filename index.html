<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランダム動画再生</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    #startButton {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 15px 30px;
      font-size: 20px;
      z-index: 10;
      cursor: pointer;
    }
  </style>
</head>
<body>

<video id="video" autoplay muted loop>
  <source src="intro.mp4" type="video/mp4">
</video>
<button id="startButton">スタート</button>

<script>
const video = document.getElementById('video');
const button = document.getElementById('startButton');

const mainVideos = [
  "video1.mp4",
  "video2.mp4",
  "video3.mp4",
  "video4.mp4",
  "video5.mp4",
  "video6.mp4",
  "video7.mp4",
  "video8.mp4",
  "video9.mp4"
];

const introVideo = "intro.mp4";

button.addEventListener('click', () => {
  playRandomMainVideo();
});

function playRandomMainVideo() {
  const index = Math.floor(Math.random() * mainVideos.length);
  const selectedVideo = mainVideos[index];

  // 読み込みエラーチェック
  fetch(selectedVideo, { method: 'HEAD' })
    .then(response => {
      if (!response.ok) throw new Error('動画ファイルが見つかりません: ' + selectedVideo);
      video.src = selectedVideo;
      video.loop = false;
      video.muted = false;
      video.play().catch(err => console.error('再生エラー:', err));
      button.style.visibility = 'hidden';
      video.addEventListener('ended', handleEnded, { once: true });
    })
    .catch(err => {
      console.error(err);
      alert('動画の読み込みに失敗しました: ' + selectedVideo);
      // イントロに戻す
      resetToIntro();
    });
}

function handleEnded() {
  resetToIntro();
}

function resetToIntro() {
  video.src = introVideo;
  video.loop = true;
  video.muted = true;
  video.play().catch(err => console.error('イントロ再生エラー:', err));
  button.style.visibility = 'visible';
}
</script>

</body>
</html>
